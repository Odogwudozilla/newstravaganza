
<h1>News From Around The World</h1>
<style>
  #map {
    height: 500px;
    width: 100%;
  }
</style>
<div id="map"></div>

<script>
  function initMap() {
    var all_countries = <%=raw @all_countries.to_json %>;
    var location = {lat: 57.1653 , lng: 2.1045};
     var map = new google.maps.Map(document.getElementById("map"), {
      zoom: 5,
      center: location
    });


  var markers = [];
  var n = markers.length;
   for (var i = 0; i < n; i++) {
     var lat = markers[i].latitude;
     var lng = markers[i].longitude;
     if (lat == null || lng ==null){
       console.log(markers[i].name + " doesn't have coordinates");
     }else {
       var marker = new google.maps.Marker({
         position: {lat: parseFloat(lat), lng: parseFloat(lng)},
         title: markers[i].name,
         map: map
       });
       bounds.extend(marker.position);
     }
   }
   map.fitBounds(bounds);



  for (var i = 0, length = all_countries.length; i < length; i++)
  {
                       var country = all_countries[i];

                       var info =  "<strong>" + country.name + "</strong><br/>" + "<a id='countrynews' href='/usersearches/search/" + country.name +"'>News</a>";

                       var infowindow = new google.maps.InfoWindow({
                        content: info
                        });


  }



                    markers_array.forEach(function(marker){
                             marker.addListener('click', function() {
                              infowindow.setContent(marker.content);
                              infowindow.open(map, marker);
                         });
                       });



}

</script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7jozg_f46_xudB4bPwi7xaltmjTcaNBQ&callback=initMap"></script>
